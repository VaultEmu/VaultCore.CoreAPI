<?xml version="1.0"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <EnableDynamicLoading>true</EnableDynamicLoading>
    </PropertyGroup>
    
    <UsingTask TaskName="VaultCore.BuildTasks.JsonManifestGenerationBuildTask"
               AssemblyFile="$(MSBuildThisFileDirectory)..\build\VaultCore.BuildTaskLib.dll"/>

    <Target Name="CreateCoreJsonManifest" AfterTargets="CopyFilesToOutputDirectory" BeforeTargets="GetCopyFilesToOutputDirectoryItems">
        <JsonManifestGenerationBuildTask DllPath="$(TargetPath)" ManifestOutputPath="$(IntermediateOutputPath)$(TargetName)_Manifest.json"/>
    </Target>
    
    <Target Name="CopyGeneratedData" AfterTargets="CreateCoreJsonManifest" BeforeTargets="GetCopyFilesToOutputDirectoryItems">
        <ItemGroup>
            <Content Include="$(IntermediateOutputPath)$(TargetName)_Manifest.json">
                <CopyToOutputDirectory>Always</CopyToOutputDirectory>
            </Content>
        </ItemGroup>
    </Target>
</Project>